<div class="space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <h1 class="text-3xl font-bold text-foreground">Fee Plans</h1>
    <hlm-dialog>
      <button brnDialogTrigger hlmBtn class="bg-primary hover:bg-primary-dark">
        âž• Add Fee
      </button>
      <hlm-dialog-content
        class="w-full max-w-none md:w-[600px] max-h-[450px] overflow-y-scroll lg:w-[800px]"
        *brnDialogContent="let ctx"
      >
        <app-fee-structure></app-fee-structure>
      </hlm-dialog-content>
    </hlm-dialog>
  </div>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <div hlmCard>
      <div hlmCardHeader class="pb-2">
        <span hlmCardTitle class="text-sm font-medium text-muted-foreground">
          Total Admission Fees
        </span>
      </div>
      <div hlmCardContent>
        <div class="text-2xl font-bold text-foreground">
          {{ formatCurrency(totalAdmissionFees) }}
        </div>
      </div>
    </div>

    <div hlmCard>
      <div hlmCardHeader class="pb-2">
        <span hlmCardTitle class="text-sm font-medium text-muted-foreground">
          Total Security Deposits
        </span>
      </div>
      <div hlmCardContent>
        <div class="text-2xl font-bold text-foreground">
          {{ formatCurrency(totalSecurityDeposits) }}
        </div>
      </div>
    </div>

    <div hlmCard>
      <div hlmCardHeader class="pb-2">
        <span hlmCardTitle class="text-sm font-medium text-muted-foreground">
          Total Discounts
        </span>
      </div>
      <div hlmCardContent>
        <div class="text-2xl font-bold text-success">
          {{ formatCurrency(totalDiscounts) }}
        </div>
      </div>
    </div>
  </div>

  <!-- Search -->
  <div class="flex flex-col sm:flex-row gap-4">
    <div class="flex-1">
      <input
        hlmInput
        placeholder="Search fee plans by title..."
        [(ngModel)]="searchTerm"
        class="w-full"
      />
    </div>
  </div>

  <!-- Fee Plans Table -->
  <div hlmCard>
    <div hlmCardHeader>
      <span hlmCardTitle>Fee Plans</span>
    </div>
    <div hlmCardContent>
      <div class="overflow-x-auto">
        <table hlmTable>
          <thead hlmThead>
            <tr hlmTr>
              <th hlmTh>Title</th>
              <th hlmTh>Grade</th>
              <th hlmTh>Admission Fee</th>
              <th hlmTh>Security Deposit</th>
              <th hlmTh>Discounts</th>
              <th hlmTh>Components</th>
              <th hlmTh>Status</th>
              <th hlmTh>Actions</th>
            </tr>
          </thead>
          <tbody hlmTbody>
            <tr hlmTr *ngFor="let plan of filteredPlans">
              <td hlmTd class="font-medium">{{ plan.title }}</td>
              <td hlmTd>{{ plan.class.grade }}</td>
              <td hlmTd>{{ formatCurrency(plan.admissionFee) }}</td>
              <td hlmTd>{{ formatCurrency(plan.securityDeposit) }}</td>
              <td hlmTd>
                <ul class="list-disc pl-4">
                  <li *ngFor="let d of plan.discounts">
                    {{ d.description }} - {{ formatCurrency(d.amount) }}
                  </li>
                </ul>
              </td>
              <td hlmTd>
                <ul class="list-disc pl-4">
                  <li *ngFor="let c of plan.components">
                    {{ c.name }} - {{ formatCurrency(c.amount) }} ({{
                      c.frequency
                    }})
                  </li>
                </ul>
              </td>
              <td>
                @if (plan.isActive) {
                <div class="text-center w-full">Active</div>
                } @else {
                <div class="text-center w-full">Not Active</div>
                }
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
